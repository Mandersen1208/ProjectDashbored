<div class="job-search-container">
  <!-- Search Form Container -->
  <div class="search-container">
    <div class="p-fluid">
      <div class="field mb-4">
        <label for="query" class="block mb-2">Job Title / Keywords</label>
        <input
          id="query"
          type="text"
          pInputText
          [(ngModel)]="searchParams.query"
          placeholder="e.g. Software Engineer"
          class="w-full"
        />
      </div>

      <div class="field mb-4">
        <label for="location" class="block mb-2">Location</label>
        <input
          id="location"
          type="text"
          pInputText
          [(ngModel)]="searchParams.location"
          placeholder="e.g. New York, NY"
          class="w-full"
        />
      </div>

      <div class="field">
        <p-button
          label="Search Jobs"
          icon="pi pi-search"
          (onClick)="onSearch()"
          [loading]="loading"
          severity="primary"
          [raised]="true"
          styleClass="w-full"
        ></p-button>
      </div>

      <div *ngIf="errorMessage" class="error-message mt-3">
        <i class="pi pi-exclamation-triangle"></i> {{ errorMessage }}
      </div>
    </div>
  </div>

  <!-- Results Container -->
  <div *ngIf="jobs.length > 0" class="results-container">
    <div class="results-header mb-3">
      <h3>Search Results ({{ jobs.length }} jobs found)</h3>
    </div>

    <p-table
      [value]="jobs"
      [paginator]="true"
      [rows]="10"
      [rowsPerPageOptions]="[10, 25, 50]"
      [loading]="loading"
      responsiveLayout="scroll"
      styleClass="p-datatable-striped"
    >
      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="title">
            Job Title <p-sortIcon field="title"></p-sortIcon>
          </th>
          <th pSortableColumn="companyName">
            Company <p-sortIcon field="companyName"></p-sortIcon>
          </th>
          <th pSortableColumn="locationName">
            Location <p-sortIcon field="locationName"></p-sortIcon>
          </th>
          <th>Salary</th>
          <th pSortableColumn="source">
            Source <p-sortIcon field="source"></p-sortIcon>
          </th>
          <th>Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-job>
        <tr>
          <td>
            <strong>{{ job.title }}</strong>
          </td>
          <td>{{ job.companyName || job.company?.display_name || 'N/A' }}</td>
          <td>{{ job.locationName || job.location?.display_name || 'N/A' }}</td>
          <td>
            <span *ngIf="job.salaryMin && job.salaryMax">
              ${{ job.salaryMin | number }} - ${{ job.salaryMax | number }}
            </span>
            <span *ngIf="!job.salaryMin || !job.salaryMax">
              Not specified
            </span>
          </td>
          <td>
            <p-tag [value]="job.source" severity="info"></p-tag>
          </td>
          <td>
            <p-button
              icon="pi pi-external-link"
              label="View Job"
              (onClick)="openJobUrl(job.jobUrl || job.redirect_url)"
              size="small"
              [text]="true"
            ></p-button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="6" class="text-center">No jobs found. Try a different search.</td>
        </tr>
      </ng-template>
    </p-table>
  </div>
</div>
