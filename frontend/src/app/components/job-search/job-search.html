<div class="job-search-container">
  <!-- Search Form Card -->
  <div class="search-card">
    <h1>Job Search</h1>

    <div class="form-grid">
      <!-- Job Title / Keywords -->
      <div class="form-field">
        <label for="query">Job Category/Title</label>
        <input
          id="query"
          type="text"
          [(ngModel)]="searchParams.query"
          placeholder="e.g. Software Engineer"
        />
      </div>

      <!-- Location -->
      <div class="form-field">
        <label for="location">Location</label>
        <input
          id="location"
          type="text"
          [(ngModel)]="searchParams.location"
          placeholder="e.g. New York, NY"
        />
      </div>

      <!-- Distance -->
      <div class="form-field">
        <label for="distance">Distance (miles)</label>
        <select
          id="distance"
          [(ngModel)]="searchParams.distance"
        >
          <option value="5">5 miles</option>
          <option value="10">10 miles</option>
          <option value="15">15 miles</option>
          <option value="25">25 miles</option>
          <option value="50">50 miles</option>
          <option value="100">100 miles</option>
        </select>
      </div>
    </div>

    <!-- Search Button -->
    <div class="button-container">
      <button
        (click)="onSearch()"
        [disabled]="loading"
        class="search-button"
      >
        <i *ngIf="!loading" class="pi pi-search"></i>
        <i *ngIf="loading" class="pi pi-spin pi-spinner"></i>
        {{ loading ? 'Searching...' : 'Search Jobs' }}
      </button>
    </div>

    <!-- Error Message -->
    <div *ngIf="errorMessage" class="error-message">
      <i class="pi pi-exclamation-triangle"></i>
      <span>{{ errorMessage }}</span>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-card">
    <div class="loading-spinner-container">
      <div class="loading-spinner-glow"></div>
      <i class="pi pi-spin pi-spinner loading-spinner"></i>
    </div>
    <p class="loading-text">Loading results...</p>
  </div>

  <!-- Results Table -->
  <div *ngIf="jobs.length > 0 && !loading" class="results-card">
    <h2>Search Results ({{ jobs.length }} jobs found)</h2>

    <div class="results-table-container">
      <table class="results-table">
        <thead>
          <tr>
            <th>Job Title</th>
            <th>Company</th>
            <th>Location</th>
            <th>Salary</th>
            <th>Source</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let job of paginatedJobs">
            <td>
              <strong>{{ job.title }}</strong>
            </td>
            <td>
              {{ job.companyName || job.company?.display_name || 'N/A' }}
            </td>
            <td>
              {{ job.locationName || job.location?.display_name || 'N/A' }}
            </td>
            <td>
              <span *ngIf="job.salaryMin && job.salaryMax">
                ${{ job.salaryMin}} - ${{ job.salaryMax}}
              </span>
              <span *ngIf="!job.salaryMin || !job.salaryMax">
                Not specified
              </span>
            </td>
            <td>
              <span class="source-badge">
                {{ job.source }}
              </span>
            </td>
            <td>
              <button
                (click)="openJobUrl(job.jobUrl || job.redirect_url)"
                class="view-job-button"
              >
                <i class="pi pi-external-link"></i>
                View Job
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Pagination Controls -->
    <div class="pagination-container">
      <div class="pagination-info">
        <span>
          Showing {{ (currentPage - 1) * pageSize + 1 }} to
          {{ Math.min(currentPage * pageSize, jobs.length) }} of
          {{ jobs.length }} results
        </span>
        <div class="page-size-selector">
          <label for="pageSize">Rows per page:</label>
          <select id="pageSize" [value]="pageSize" (change)="changePageSize($event)">
            <option *ngFor="let size of pageSizeOptions" [value]="size">{{ size }}</option>
          </select>
        </div>
      </div>

      <div class="pagination-buttons">
        <button
          (click)="previousPage()"
          [disabled]="currentPage === 1"
          class="pagination-button pagination-nav"
        >
          <i class="pi pi-chevron-left"></i>
          <span class="pagination-label">Previous</span>
        </button>

        <button
          *ngFor="let page of visiblePages"
          (click)="isEllipsis(page) ? null : goToPage($any(page))"
          [disabled]="isEllipsis(page)"
          [class.active]="page === currentPage"
          [class.ellipsis]="isEllipsis(page)"
          class="pagination-button page-number"
        >
          {{ page }}
        </button>

        <button
          (click)="nextPage()"
          [disabled]="currentPage === totalPages"
          class="pagination-button pagination-nav"
        >
          <span class="pagination-label">Next</span>
          <i class="pi pi-chevron-right"></i>
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div *ngIf="jobs.length === 0 && !loading && searchParams.query" class="empty-state">
    <i class="pi pi-search"></i>
    <h3>No jobs found</h3>
    <p>Try adjusting your search criteria</p>
  </div>
</div>
